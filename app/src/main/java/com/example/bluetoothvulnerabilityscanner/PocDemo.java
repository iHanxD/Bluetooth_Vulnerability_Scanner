package com.example.bluetoothvulnerabilityscanner;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.widget.Adapter;
import android.widget.TextView;

import com.denzcoskun.imageslider.ImageSlider;
import com.denzcoskun.imageslider.models.SlideModel;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;

import java.util.ArrayList;

public class PocDemo extends AppCompatActivity implements AdapterPocDemoCard.OnItemListener{

    private static final String TAG = "PocDemo";


    //Database link instance
    FirebaseDatabase database = FirebaseDatabase.getInstance("https://bluetoothvulnscannerdb-default-rtdb.asia-southeast1.firebasedatabase.app");


    ArrayList<DataPocDemoCard> list;
    ArrayList<String> imagelinks;
    RecyclerView recyclerView;
    AdapterPocDemoCard adapterpocdemocard;
    Context context = this;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_poc_demo);
        setTitle("PoCs & Demos");

        list = new ArrayList<>();

        recyclerView = findViewById(R.id.pocdemoholder);
        adapterpocdemocard = new AdapterPocDemoCard(context, list, this);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(this));
        recyclerView.setAdapter(adapterpocdemocard);

        DatabaseReference pocdemo = database.getReference("Poc_Demo");

        if (pocdemo != null) {
            pocdemo.addValueEventListener(new ValueEventListener() {

                @Override
                public void onDataChange(@NonNull DataSnapshot snapshot) {
                    if (snapshot.exists()) {

                        for (DataSnapshot ds : snapshot.getChildren()) {

                            imagelinks = new ArrayList<>();

                            String key = ds.getKey();
                            String title = ds.child("title").getValue(String.class);
                            String pocdemotype = ds.child("type").getValue(String.class);
                            Log.v(TAG, "title" + title);


                            DataSnapshot imageBranch = ds.child("images");
                            for (DataSnapshot ds2 : imageBranch.getChildren()) {

                                String imgkey = ds2.getKey();
                                Class type = ds2.getValue().getClass();
                                if (type == String.class) {

                                    String linkvalue = ds2.getValue(String.class);

                                    Log.v(TAG, "imagekey: " + imgkey); //displays the key for the node
                                    Log.v(TAG, "imagelink: " + linkvalue); //displays the key for the node

                                    if(linkvalue!=null){
                                        imagelinks.add(linkvalue);
                                    }
                                }
                            }

                            list.add(new DataPocDemoCard(key, title, pocdemotype, imagelinks));

                        }

                        adapterpocdemocard.notifyDataSetChanged();
                    }

                }

                @Override
                public void onCancelled(@NonNull DatabaseError error) {
                    Log.d("SearchDevices", "DATABASE ERROR", error.toException());
                }
            });


        }
    }

    @Override
    public void onItemClick(int position) {

        String pocdemoid = list.get(position).getKey();

        Log.d("onItemClick", pocdemoid);

        Intent intent = new Intent(context, DisplayPocDemo.class);
        intent.putExtra("pocdemoid", pocdemoid);
        startActivity(intent);

    }
}